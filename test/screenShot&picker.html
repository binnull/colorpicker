<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>test</title>
    <style>
        .span{
            color: red;
            text-align: center;
        }
        #test a{
            background-color: green;
        }
    </style>
    <script src="html2canvas.js"></script>
</head>
<body>
<div id="test">
    <div>
        <a href="" style="color: aqua">
            111111
        </a>
        <!--<img src="1.png" style="width: 20px ;height: 20px;" alt="">-->
    </div>
    <nav>
        <ul>
            <em style="color: #dddddd; font-size: 20px" >
                happy
            </em>
        </ul>
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" version="1.1">

                <ellipse cx="300" cy="150" rx="200" ry="80" style="fill:rgb(200,100,50); stroke:rgb(0,0,100);stroke-width:2"/>

                <div xmlns="http://www.w3.org/1999/xhtml"></div></svg>
        </div>
    </nav>
    <ul>
        <li>
            <span class="span">
                dfinafi
            </span>
        </li>
        <li>
            <span class="span">
                aaa
            </span>
        </li>
        <li>
            <span class="span">
                bbb
            </span>
        </li>
        <li>
            <span class="span">
                ccc
            </span>
        </li>
    </ul>
</div>
<canvas id="canvas" style="border:2px solid black;" width="1000" height="1000"></canvas>
<script>
    var copy=document.createElement("div");
    copy.classList.add("copy");
    copy.appendChild(document.querySelector("#test").cloneNode());      //copy#test下的元素进行测试
    find(document.querySelector("#test"),copy.querySelector("#test"));
    setStyle(document.querySelector("#test"),copy.querySelector("#test"));
    function find(ele,copy){
        for(var i=0; i<ele.childNodes.length;i++){
            copy.appendChild(ele.childNodes[i].cloneNode());
            find(ele.childNodes[i],copy.childNodes[i]);
        }
    }
    function setStyle(ele,copy){
        for(var i=0; i<ele.children.length;i++){
            for(var style in getStyle(ele.children[i])){
                copy.children[i].style[style]=getStyle(ele.children[i])[style];
            }
            setStyle(ele.children[i],copy.children[i]);
        }
    }
    function getStyle(ele) {
        var style = null;
        if(window.getComputedStyle) {
            style = window.getComputedStyle(ele, null);
        }else{
            style = ele.currentStyle;
        }
        return style;
    }
    console.log(copy);
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    var data = "<svg xmlns='http://www.w3.org/2000/svg' width='1000' height='1000'>" +
            "<switch>" +
            "<foreignObject width='100%' height='100%'>" +
            "<body xmlns='http://www.w3.org/1999/xhtml'>" +
                    copy.outerHTML+
            "</body>" +
            "</foreignObject>" +
            "</switch>" +
            "</svg>";
    var img = new Image;
    img.onload = function() {
        ctx.drawImage(img, 0, 0);
        //测试能否取到像素数据（canvas是否被污染）注：当img.src为'blob：'时，chrome报错被污染；为'data：'时safari报错被污染
        for(var i=0;i<ctx.getImageData(0,0,20,20).data.length;i++){
            if(ctx.getImageData(0,0,20,20).data[i]!=0){
                console.log(i+":"+ctx.getImageData(0,0,20,20).data[i]);
            }
        }
    };
    img.crossorigin="anonymous";
    img.crossdomain = true;
    img.src = 'data:image/svg+xml;base64,'+btoa(data);
    document.querySelector("body").appendChild(img);

    //作为比较的html2canvas
//    html2canvas(document.querySelector("#test"),{
//        onrendered:function(canvas){
//            canvas.classList.add("temp");
//            document.body.appendChild(canvas);
//            var ctx=document.querySelector(".temp").getContext('2d');
//            console.log(ctx.getImageData(0,0,100,100).data);
//        }
//    });
</script>
</body>
</html>